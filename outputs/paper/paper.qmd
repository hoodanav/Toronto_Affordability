---
title: "Is being 'successful' adequate to afford a decent standard lifestyle in Toronto? Assessing Toronto's Living Standards by Neighbourhood"

author: 
  - Navya Hooda

thanks: "Code and data are available at: https://github.com/hoodanav/Toronto_Affordability"
date: 22 January, 2024
date-format: long
abstract: "Census 2021 results published in the dataset Ward Profile (25 Ward Model) were used in assessing living standards in Toronto. Based on Income, Education levels, Shelter costs it is shown that being socio-economically successful does not directly correlate to affording an easy life in Toronto. The paper assesses the living standards of top earners and qualified residents to show the decreasing affordability in Toronto."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| message: false
#| echo: false

#### Workspace set-up ####

## Load packages
library(tidyverse) # a collection of data-related packages
library(knitr) # for kable
library(kableExtra)
library(here)

#### Read cleaned data ####

cleaned_ward_data = read_csv(
  file = here("inputs/data/cleaned_ward_data.csv"),
  show_col_types = FALSE
)

summarized_ward_data = read_csv(
  file = here("inputs/data/summarized_ward_data.csv"),
  show_col_types = FALSE
)
```


# Introduction

Over the past few years living expenses and affordability in Toronto has skyrocketed. Toronto is the single most expensive city in Canada (Jackson, 2023). The combination of record immigration, inflation, and a strong job market is keeping the demand for affordable housing high. As a result, the city is experiencing a high living cost. The rising costs in Toronto have lead to many residents being priced out of their own city. While Toronto usually experiences a high surge of new immigrants flowing in the city, there is a record high of residents leaving Toronto. In 2022 Toronto welcomed 138,000 new residents while 78,000 decided to leave. So much so that 1 in 4 Canadians leaving Canada, were Toronto residents (Punwasi, 2023). These realities raise the question whether the quality and standard of life in a major metropolitan city like Toronto is valuable.




# Data {#sec-data}

Data utilized in this analysis has been retrieved from Open Data Toronto using the opendatatoronto library (Gelfand 2022). The data source used is the Ward Profiles (25 Ward Model) from 2021 census data. The data has been cleaned and stored with capabilities of  the open source statistical language R (R Core Team 2022), Tidyverse (Wickham et al. 2019), ggplot2 (Wickham 2016), dplyr (Wickham et al. 2022), readr (Wickham, Hester, and Bryan 2022), tibble (MÃ¼ller and Wickham 2022), janitor (Firke 2021), knitr (Xie 2014). The specific operations and analysis done using these sources has been discussed in the further subsections.  


```{r}
#| label: income_by_ward
#| fig-cap: Income by Ward
#| echo: false

library(ggplot2)
library(dplyr)

# Check if summarized_ward_data exists and has rows
if (!exists("summarized_ward_data") || nrow(summarized_ward_data) == 0) {
  warning("No valid data for plotting.")
} else {
  # Exclude the first row
  summarized_ward_data <- summarized_ward_data[-1, ]

  # Plot the income by ward 
  ggplot(summarized_ward_data, aes(x = ward_name, y = `Total Income`)) +
    geom_bar(stat = "identity", fill = "skyblue") +
    labs(title = "Total Income by Ward",
         x = "Ward Name",
         y = "Total Income") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("outputs/data/analysis_data.csv"))

analysis_data |> 
  ggplot(aes(x = width, y = length)) +
  geom_point(alpha = 0.8) +
  theme_minimal() +
  labs(x = "Wing width (mm)",
       y = "Wing length (mm)")
```

Talk way more about it. 




# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("outputs/models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


